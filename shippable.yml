# set our development language
language: python

# set the versions of the language to test against
python:
  - 3.6
  - 3.5
  - 2.7

# build, baby, build
build:
  ci:
    # make required directories
    - mkdir -p results/testresults
    - mkdir -p results/codecoverage
    # install our requirements
    - pip install -e ".[tests]"
    # run test and code coverage and output the results to our created directories
    - pytest --junitxml=shippable/testresults/nosetests.xml
    - pytest --cov=demo --cov-report=xml:shippable/codecoverage/coverage.xml
  post_ci:
    - docker build -t ghetto/shippable-demo:$BUILD_NUMBER .
    - docker tag ghetto/shippable-demo:$BUILD_NUMBER ghetto/shippable-demo:latest
    - docker push ghetto/shippable-demo:$BUILD_NUMBER
    - docker push ghetto/shippable-demo:latest

integrations:
  hub:
    - integrationName: docker-hub
      type: docker